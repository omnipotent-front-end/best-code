<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>对象操作 | 编码技巧</title>
    <meta name="description" content="编码技巧集合">
    <link rel="stylesheet" href="/best-code/assets/style.c3210e46.css">
    <link rel="modulepreload" href="/best-code/assets/app.a8980bfd.js">
    <link rel="modulepreload" href="/best-code/assets/javascript_util_object.md.9aea56c9.lean.js">
    
    <meta name="twitter:title" content="对象操作 | 编码技巧">
  <meta property="og:title" content="对象操作 | 编码技巧">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/best-code/" aria-label="编码技巧, back to home" data-v-675d8756 data-v-cc01ef16><!----> 编码技巧</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/html/" data-v-b8818f8c>html <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/best-code/javascript/" data-v-b8818f8c>javascript <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/node/" data-v-b8818f8c>node <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/css/" data-v-b8818f8c>css <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/react/" data-v-b8818f8c>react <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/vue/" data-v-b8818f8c>vue <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/go/" data-v-b8818f8c>go <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/java/" data-v-b8818f8c>java <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/linux/" data-v-b8818f8c>linux <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://brizer.github.io/urls/zh/api.html" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>三方库 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://omnipotent-front-end.github.io/" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>知识库 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://omnipotent-front-end.github.io/-Design-Patterns-Typescript/#/" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>设计模式 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://omnipotent-front-end.github.io/Foods/" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>健康指南 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/omnipotent-front-end/best-code" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/html/" data-v-b8818f8c>html <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/best-code/javascript/" data-v-b8818f8c>javascript <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/node/" data-v-b8818f8c>node <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/css/" data-v-b8818f8c>css <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/react/" data-v-b8818f8c>react <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/vue/" data-v-b8818f8c>vue <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/go/" data-v-b8818f8c>go <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/java/" data-v-b8818f8c>java <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/best-code/linux/" data-v-b8818f8c>linux <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://brizer.github.io/urls/zh/api.html" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>三方库 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://omnipotent-front-end.github.io/" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>知识库 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://omnipotent-front-end.github.io/-Design-Patterns-Typescript/#/" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>设计模式 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://omnipotent-front-end.github.io/Foods/" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>健康指南 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/omnipotent-front-end/best-code" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">整洁之道</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/clean/variable">变量</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/clean/object">对象</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/clean/class">类</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/clean/function">函数</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/clean/array">数组</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/clean/comment">注释</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">封装util</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/util/entry">入口</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/util/effect">副作用相关</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/best-code/javascript/util/object">对象操作</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#遍历对象">遍历对象</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#对象条件封装">对象条件封装</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#过滤空值">过滤空值</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#缓存">缓存</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#proxy对象属性透传">proxy对象属性透传</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mixin增强对象">mixin增强对象</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#对象根据value排序">对象根据value排序</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/util/array">数组操作</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/util/date">日期操作</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/util/string">字符串操作</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/util/function">函数操作</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/util/number">数字操作</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/util/type">类型判断</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/util/log">日志</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">WebAPI</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/web/dom">DOM</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/web/file">FILE</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">单元测试</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/test/refer">参考最佳实践</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">异步</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/async/module">异步模块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/async/then">异步链</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/async/for">异步循环</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/async/event">事件</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Typescript</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/best-code/javascript/typescript/decorator">装饰器</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="对象操作" tabindex="-1">对象操作 <a class="header-anchor" href="#对象操作" aria-hidden="true">#</a></h1><h2 id="遍历对象" tabindex="-1">遍历对象 <a class="header-anchor" href="#遍历对象" aria-hidden="true">#</a></h2><p>利用Object.entries和for...of</p><div class="language-js"><pre><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>object1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>for (const [key, value] of Object.entries(object1)) { console.log(<code>: </code>); }</p><h2 id="对象条件封装" tabindex="-1">对象条件封装 <a class="header-anchor" href="#对象条件封装" aria-hidden="true">#</a></h2><p>通过...和三目</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
    key<span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token punctuation">(</span>keyOuter <span class="token operator">?</span> <span class="token punctuation">{</span> keyOuter <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="过滤空值" tabindex="-1">过滤空值 <a class="header-anchor" href="#过滤空值" aria-hidden="true">#</a></h2><p>基于 lodash：</p><div class="language-js"><pre><code><span class="token comment">/**
 * 过滤对象中null/undefined/[]/{}/&#39;&#39;
 * @param {object} obj 需要过滤的对象 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">omitEmpty</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">prune</span><span class="token punctuation">(</span><span class="token parameter">current</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _<span class="token punctuation">.</span><span class="token function">forOwn</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        _<span class="token punctuation">.</span><span class="token function">isUndefined</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span>
        _<span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span>
        _<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">isString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> _<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> _<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token function">prune</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">delete</span> current<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// remove any leftover undefined values from the delete // operation on an array</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">)</span> _<span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> current<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="缓存" tabindex="-1">缓存 <a class="header-anchor" href="#缓存" aria-hidden="true">#</a></h2><p>该方案基于typescript</p><p>以cache为例，首先是一个简单的cache类：<a href="https://github.com/FunnyLiu/vscode-wakatime/blob/readsource/src/cache/memory-storage.ts#L0" target="_blank" rel="noopener noreferrer">简单的cache类</a>：</p><div class="language-js"><pre><code><span class="token comment">// 一个简单的cache 类</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">MemoryStorage</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token literal-property property">memCache</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> getItem<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>key<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>memCache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> any<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>memCache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> content<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>memCache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>可以看到只是做了简单的get和set，如果需要给其增加过期时间的话，可以通过代理模式来完成，再封装一个<a href="https://github.com/FunnyLiu/vscode-wakatime/blob/readsource/src/cache/expiration-strategy.ts#L15" target="_blank" rel="noopener noreferrer">带过期策略的cache类</a>:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> MemoryStorage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./memory-storage&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">IExpiringCacheItem</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> any<span class="token punctuation">;</span>
    <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">createdAt</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
        <span class="token literal-property property">ttl</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">IOptions</span> <span class="token punctuation">{</span>
    ttl<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
    isLazy<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>
    isCachedForever<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 一个带过期时间功能的cache类，对普通的cache类包装了一层进行了代理模式，以及promise的封装</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExpirationStrategy</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> readonly storage<span class="token operator">:</span> MemoryStorage<span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">storage</span><span class="token operator">:</span> MemoryStorage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>storage <span class="token operator">=</span> storage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> getItem<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>key<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> _</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span>getItem<span class="token operator">&lt;</span>IExpiringCacheItem<span class="token operator">&gt;</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>meta <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>ttl <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isItemExpired</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            item <span class="token operator">?</span> <span class="token function">resolve</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>content<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> IOptions<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">ttl</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token literal-property property">isLazy</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">isCachedForever</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span>

        <span class="token keyword">let</span> meta <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>isCachedForever<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            meta <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">ttl</span><span class="token operator">:</span> options<span class="token punctuation">.</span>ttl<span class="token operator">!</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
                <span class="token literal-property property">createdAt</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>isLazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsetKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>ttl<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">{</span>meta<span class="token punctuation">,</span> content<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token function">isItemExpired</span><span class="token punctuation">(</span>item<span class="token operator">:</span> IExpiringCacheItem<span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> item<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>createdAt <span class="token operator">+</span> item<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>ttl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token function">unsetKey</span><span class="token punctuation">(</span>key<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>storage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后将第一个cache类作为实例化对象传入即可:</p><div class="language-js"><pre><code><span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExpirationStrategy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MemoryStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>从而完成整个代理过程。</p><h2 id="proxy对象属性透传" tabindex="-1">proxy对象属性透传 <a class="header-anchor" href="#proxy对象属性透传" aria-hidden="true">#</a></h2><p>找bridge.a其实就是去找bridge.rnCallNative.a</p><p>适合于将一个对象上所有东西，挂到另一个对象上往外去暴露</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">const</span> bridge <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>bridgeBase<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>supportBridgeName<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>rnCallNative <span class="token operator">||</span> f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>bridge<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="mixin增强对象" tabindex="-1">mixin增强对象 <a class="header-anchor" href="#mixin增强对象" aria-hidden="true">#</a></h2><p>当对象的方法需要区分命名空间或者说是外部增强，可以通过mixin的思路。</p><p>参考<a href="https://github.com/FunnyLiu/cropperjs/blob/readsource/src/js/cropper.js#L448" target="_blank" rel="noopener noreferrer">笔记内容</a></p><div class="language-js"><pre><code><span class="token comment">//mixin模式扩展Cropper类</span>
<span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">Cropper</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> render<span class="token punctuation">,</span> preview<span class="token punctuation">,</span> events<span class="token punctuation">,</span> handlers<span class="token punctuation">,</span> change<span class="token punctuation">,</span> methods<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>通过其他几个文件暴露不同的方法来增强对象，assign函数为：</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">const</span> assign <span class="token operator">=</span> Object<span class="token punctuation">.</span>assign <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    args<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> target<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>其他的文件如event，暴露几个函数即可：</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  <span class="token constant">EVENT_CROP</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_CROP_END</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_CROP_MOVE</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_CROP_START</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_DBLCLICK</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_POINTER_DOWN</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_POINTER_MOVE</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_POINTER_UP</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_RESIZE</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_WHEEL</span><span class="token punctuation">,</span>
  <span class="token constant">EVENT_ZOOM</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./constants&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  addListener<span class="token punctuation">,</span>
  isFunction<span class="token punctuation">,</span>
  removeListener<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./utilities&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> element<span class="token punctuation">,</span> options<span class="token punctuation">,</span> cropper <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>cropstart<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">addListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_CROP_START</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>cropstart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>cropmove<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">addListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_CROP_MOVE</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>cropmove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>cropend<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">addListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_CROP_END</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>cropend<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>crop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">addListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_CROP</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>crop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>zoom<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">addListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_ZOOM</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>zoom<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">addListener</span><span class="token punctuation">(</span>cropper<span class="token punctuation">,</span> <span class="token constant">EVENT_POINTER_DOWN</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onCropStart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cropStart</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>zoomable <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>zoomOnWheel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">addListener</span><span class="token punctuation">(</span>cropper<span class="token punctuation">,</span> <span class="token constant">EVENT_WHEEL</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onWheel <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">passive</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">capture</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>toggleDragModeOnDblclick<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">addListener</span><span class="token punctuation">(</span>cropper<span class="token punctuation">,</span> <span class="token constant">EVENT_DBLCLICK</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onDblclick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dblclick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">addListener</span><span class="token punctuation">(</span>
      element<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">,</span>
      <span class="token constant">EVENT_POINTER_MOVE</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onCropMove <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cropMove</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addListener</span><span class="token punctuation">(</span>
      element<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">,</span>
      <span class="token constant">EVENT_POINTER_UP</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onCropEnd <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cropEnd</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>responsive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">addListener</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token constant">EVENT_RESIZE</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onResize <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">unbind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> element<span class="token punctuation">,</span> options<span class="token punctuation">,</span> cropper <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>cropstart<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">removeListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_CROP_START</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>cropstart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>cropmove<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">removeListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_CROP_MOVE</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>cropmove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>cropend<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">removeListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_CROP_END</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>cropend<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>crop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">removeListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_CROP</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>crop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>zoom<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">removeListener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token constant">EVENT_ZOOM</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>zoom<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">removeListener</span><span class="token punctuation">(</span>cropper<span class="token punctuation">,</span> <span class="token constant">EVENT_POINTER_DOWN</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onCropStart<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>zoomable <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>zoomOnWheel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">removeListener</span><span class="token punctuation">(</span>cropper<span class="token punctuation">,</span> <span class="token constant">EVENT_WHEEL</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onWheel<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">passive</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">capture</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>toggleDragModeOnDblclick<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">removeListener</span><span class="token punctuation">(</span>cropper<span class="token punctuation">,</span> <span class="token constant">EVENT_DBLCLICK</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onDblclick<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">removeListener</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">,</span> <span class="token constant">EVENT_POINTER_MOVE</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onCropMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">removeListener</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">,</span> <span class="token constant">EVENT_POINTER_UP</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onCropEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>responsive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">removeListener</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token constant">EVENT_RESIZE</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


</code></pre></div><h2 id="对象根据value排序" tabindex="-1">对象根据value排序 <a class="header-anchor" href="#对象根据value排序" aria-hidden="true">#</a></h2><p>弯道超车：</p><div class="language-js"><pre><code>  <span class="token comment">// 对object的value排序拿到对应的key列表</span>
  <span class="token keyword">const</span> sortedObjKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>appSuccessMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> appSuccessMap<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">-</span> appSuccessMap<span class="token punctuation">[</span>a<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 再通过指定key拿到内容</span>
  <span class="token keyword">const</span> successDataList <span class="token operator">=</span> sortedObjKeys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> appSuccessMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/best-code/javascript/util/effect" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>副作用相关</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/best-code/javascript/util/array" data-v-38ede35f><span class="text" data-v-38ede35f>数组操作</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"css_animate.md\":\"5abc076d\",\"css_global.md\":\"03b0dda0\",\"css_index.md\":\"00d3a390\",\"css_scss.md\":\"3fd0c24e\",\"go_grammar_basic.md\":\"c42f707e\",\"go_grammar_better.md\":\"d7af1dbf\",\"go_index.md\":\"3f8765ad\",\"html_grammar_head.md\":\"928c9568\",\"html_index.md\":\"66095ff7\",\"index.md\":\"0ca068a4\",\"java_grammar_basic.md\":\"f064c45a\",\"java_index.md\":\"698bb0d9\",\"javascript_async_event.md\":\"946f86fd\",\"javascript_async_for.md\":\"41804474\",\"javascript_async_module.md\":\"222124e3\",\"javascript_async_then.md\":\"215638db\",\"javascript_clean_array.md\":\"fd9beb27\",\"javascript_clean_class.md\":\"cbe8b0e8\",\"javascript_clean_comment.md\":\"6b79a6f2\",\"javascript_clean_function.md\":\"865eaf25\",\"javascript_clean_object.md\":\"0c17f178\",\"javascript_clean_variable.md\":\"434f6123\",\"javascript_index.md\":\"e15ab524\",\"javascript_test_refer.md\":\"332891e8\",\"javascript_typescript_decorator.md\":\"69c76164\",\"javascript_util_array.md\":\"bbae5c5b\",\"javascript_util_date.md\":\"f5b1d721\",\"javascript_util_effect.md\":\"63f98682\",\"javascript_util_entry.md\":\"d1ff8a05\",\"javascript_util_function.md\":\"277100b1\",\"javascript_util_log.md\":\"9767b2f2\",\"javascript_util_number.md\":\"0fb2c411\",\"javascript_util_object.md\":\"9aea56c9\",\"javascript_util_string.md\":\"b41b2069\",\"javascript_util_type.md\":\"a2496b9a\",\"javascript_web_dom.md\":\"1ff4198f\",\"javascript_web_file.md\":\"7bede717\",\"javascript_web_index.md\":\"ed688b4b\",\"linux_index.md\":\"0dce85a2\",\"linux_usage_file.md\":\"f717be55\",\"linux_usage_network.md\":\"a0b96e3a\",\"linux_usage_nginx.md\":\"e4e0915f\",\"node_build_pack.md\":\"3b7549d6\",\"node_build_webpack.md\":\"7ca1cbe1\",\"node_cli_config.md\":\"e42dd6e8\",\"node_cli_pipe.md\":\"2731d30e\",\"node_cli_refer.md\":\"cf3088c1\",\"node_cli_ua.md\":\"84c943ef\",\"node_fs_fs.md\":\"72147d33\",\"node_index.md\":\"e6c66e46\",\"node_process_child_process.md\":\"3bf04f53\",\"node_process_worker_thread.md\":\"04ce6fd5\",\"react_grammar_jsx.md\":\"857b08c8\",\"react_index.md\":\"c12f8636\",\"vue_grammar_compositions.md\":\"59b11af9\",\"vue_grammar_jsx.md\":\"ce1b0404\",\"vue_grammar_sfc.md\":\"b30f8df9\",\"vue_index.md\":\"0c2f897d\"}")</script>
    <script type="module" async src="/best-code/assets/app.a8980bfd.js"></script>
    
  </body>
</html>